![OrderLabs](./images/Banner.png)

<h1 align="center" style="color: #50C878;"> OrderLabs ğŸŒ¿</h1>

<br><br>

## ğŸ’­ í”„ë¡œì íŠ¸ ê°œìš”

![Grafana](./images/Grafana.png)

<br>

- í”„ë¡œì íŠ¸ ê¸°íšì„œ ì‘ì„±
- ìš”êµ¬ì‚¬í•­ ì •ì˜ì„œ ì‘ì„±
- ERD ì‘ì„±
- Database Architecture ì‘ì„±
- SQL íŠœë‹ (ì¿¼ë¦¬ êµ¬ì¡° ë³€ê²½ ë° Index ì‚¬ìš©)

<br>

#### + í”„ë¡œì íŠ¸ êµ¬ì„±í™˜ê²½

- Mariadb, 10.6.22 version
- Mysql, 8.0.42 version (EXPLAINê³¼ EXPLAIN ALYZE í™•ì¸ìš©)
- JMeter
- Prometheus
- Grafana

<br>

**JMeter**ë¡œ **Database**ì— ì§ì ‘ ë¶€í•˜ë¥¼ ì£¼ì–´ **Prometheus**ì™€ **Grafana**ë¥¼ í†µí•´ ë¶€í•˜ ì–‘ìƒì„ ì‹œê°ì ìœ¼ë¡œ ê´€ì°°í•  í•˜ì˜€ê³ , SQL íŠœë‹ì„ í†µí•´ ì„±ëŠ¥ í–¥ìƒì„ ê¸°ëŒ€í•˜ì˜€ì§€ë§Œ ë°ì´í„° ìˆ˜ì˜ ë¶€ì¡±ìœ¼ë¡œ ê·¹ì ì¸ ì„±ëŠ¥ í–¥ìƒì€ ì–»ì§€ ëª»í–ˆì§€ë§Œ, Mariadbê°€ ì•„ë‹Œ Mysqlë¡œ ë°ì´í„° ë² ì´ìŠ¤ë¥¼ ë³€ê²½í•˜ì—¬ `EXPLAIN`ê³¼ `EXPLAIN ANALYZE` ë¬¸ì„ í†µí•´ ì„±ëŠ¥ í–¥ìƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆë‹¤.

<br><br>

## ğŸ§‘ğŸ»â€ğŸŒ¾ í”„ë¡œì íŠ¸ ì†Œê°œ

<div>
  <h3 align="center">
    "ìë¼ëŠ” ë§Œí¼ë§Œ ì£¼ë¬¸ë°›ëŠ”ë‹¤."
  </h3>
</div>

 <br>

ì´ ì„œë¹„ìŠ¤ëŠ” ë†Â·ìˆ˜ì‚°ë¬¼ì˜ ìƒìœ¡ ìƒíƒœë‚˜ ìƒë¬¼ì˜ ê±´ê°• ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì£¼ë¬¸ ê°€ëŠ¥ ì—¬ë¶€ë¥¼
ìë™ íŒë‹¨í•˜ê³  ê´€ë¦¬í•˜ëŠ” ìŠ¤ë§ˆíŠ¸ ì£¼ë¬¸ ê´€ë¦¬ í”Œë«í¼ì…ë‹ˆë‹¤.
ê¸°ì¡´ì˜ ë‹¨ìˆœ ì¬ê³  ê¸°ë°˜ íŒë§¤ ë°©ì‹ê³¼ ë‹¬ë¦¬, ìƒë¬¼ì˜ ìƒìœ¡ë°ì´í„° ì—¬ê¸°ì„œëŠ” ê³µê³µ ë°ì´í„°(ì˜ˆ:
ê¸°ìƒì •ë³´, ìƒìœ¡ ì„¼ì„œ ë°ì´í„° ë“±)ì™€ ì‹¤ì‹œê°„ ìˆ˜ì§‘ëœ ìƒë¬¼ ì •ë³´(ì˜ˆ: ìˆ˜ì‚°ë¬¼ ì„±ì¥ë¥ , ê±´ê°•ë„)ë¥¼
ë¶„ì„í•˜ì—¬ ì–¸ì œ ì£¼ë¬¸ì„ ë°›ì„ ìˆ˜ ìˆê³ , ì–¸ì œ ë°°ì†¡ì´ ê°€ëŠ¥í•œì§€ë¥¼ ì˜ˆì¸¡ ë° ìë™ í†µì œí•©ë‹ˆë‹¤.
ì´ë¥¼ í†µí•´ ìƒì‚°ìëŠ” ì¬ê³  ê³¼ì‰ì´ë‚˜ ë¬´ë¦¬í•œ ì£¼ë¬¸ì„ ë°©ì§€í•˜ê³ , ì†Œë¹„ìëŠ” ë” ì‹ ì„ í•˜ê³  ì •í™•í•œ
ì¼ì •ìœ¼ë¡œ ìƒí’ˆì„ ìˆ˜ë ¹í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ìƒë¬¼ì€ ìë¼ì•¼ íŒ” ìˆ˜ ìˆìŠµë‹ˆë‹¤. <br><br>

ìš°ë¦¬ëŠ” ê·¸ **ìë¼ëŠ” ê³¼ì •**ê¹Œì§€ ì£¼ë¬¸ ì‹œìŠ¤í…œì— ë‹´ìŠµë‹ˆë‹¤.

<br><br>

## ğŸ•µï¸ íŒ€ì› ì†Œê°œ

<div align="center">

| <img src="https://avatars.githubusercontent.com/u/149382180?v=4" width="100" height="100"/> | <img src="https://avatars.githubusercontent.com/u/96688099?v=4" width="100" height="100"/> | <img src="https://avatars.githubusercontent.com/u/195714592?v=4" width="100" height="100"/> | <img src="https://avatars.githubusercontent.com/u/92301360?v=4" width="100" height="100"/> | <img src="https://avatars.githubusercontent.com/u/201225844?v=4" width="100" height="100"/> |
| :-----------------------------------------------------------------------------------------: | :----------------------------------------------------------------------------------------: | :-----------------------------------------------------------------------------------------: | :----------------------------------------------------------------------------------------: | :-----------------------------------------------------------------------------------------: |
|                 ğŸ¦Š **ì–‘ìŠ¹ìš°**<br/>[@atimaby28](https://github.com/miyad927)                 |                ğŸ» **ì´ì‹œìš±**<br/>[@David9733](https://github.com/David9733)                |                 ğŸ¦ **êµ¬ì°½ëª¨**<br/>[@kucha240](https://github.com/kucha240)                  |                ğŸ° **ìœ í˜„ê²½**<br/>[@gaangstar](https://github.com/gaangstar)                |                  ğŸ± **ìœ¤ì†Œë¯¼**<br/>[@somminn](https://github.com/somminn)                   |

</div>

<br><br>

## ğŸ§¶ ê¸°íšì„œ ì´ˆì•ˆ ì‘ì„±

![ê¸°íšì„œ](./images/Scenario.png)

ê¸°íšì„œ ì´ˆì•ˆì— í”„ë¡œì íŠ¸ ì†Œê°œ, í”„ë¡œì íŠ¸ ì°¨ë³„ì , ì‚¬íšŒì  íƒ€ë‹¹ì„± ë° í•„ìš”ì„± ë“±ì„ ë‹´ìœ¼ë ¤ ë…¸ë ¥í•˜ì˜€ìŠµë‹ˆë‹¤.

<br><br>

## ğŸ§© ìš”êµ¬ ì‚¬í•­ ëª…ì„¸ì„œ ë°”ë¡œê°€ê¸°

![ìš”êµ¬ì‚¬í•­](./images/Requirements.png)

<div align="center">
  <a href="https://docs.google.com/spreadsheets/d/1xPRM4gAtze_Mu-vF_rwFMtvYI7baOceUvJYlSDdcA-o/edit?gid=1400486362#gid=1400486362" target="_blank">
    ğŸ”— ìš”êµ¬ì‚¬í•­ ëª…ì„¸ì„œ ë°”ë¡œê°€ê¸°
  </a>
</div>

<br><br>

## â˜ï¸ ERD

![OrderLabs-erd](./03_ERD.png)

<div align="center">
  <a href="https://www.erdcloud.com/d/GjgSeJRtpNC9jNFpG" target="_blank">
    ğŸ”— ERD ë°”ë¡œê°€ê¸°
  </a>
</div>

<br><br>

## âš™ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

![04_Architecture](04_Architecture.png)

<br><br>

<div align=center>
    ì €í¬ëŠ” ë°ì´í„°ë² ì´ìŠ¤ ì„œë²„ë¥¼ 6ëŒ€ë¥¼ êµ¬ì„±í•˜ì˜€ê³  <br>
    ë‘ ì„œë²„ëŠ” Replication, ì„¸ ì„œë²„ëŠ” Clustering ë‚˜ë¨¸ì§€ í•œ ì„œë²„ëŠ” ì—°ì‚°ì„ ìœ„í•œ ì „ìš© ì„œë²„ë¡œ êµ¬ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.
</div>

<br><br>

### - Why replication?

ìš´ì˜ ì„œë²„ëŠ” ë‹¨ì¼ DB ì¥ì•  ì‹œ ì „ì²´ ì„œë¹„ìŠ¤ê°€ ì¤‘ë‹¨ë˜ëŠ” ê²ƒì„ ë§‰ê¸° ìœ„í•´ ë°ì´í„° ë³µì œ(Data Replication)ì„ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, Master-Slave êµ¬ì¡°ë¡œ êµ¬ì„±í•´ì„œ Master ì¥ì•  ì‹œ Slaveë¡œ ìë™ ì „í™˜(Failover)ì´ ê°€ëŠ¥í•˜ë„ë¡ í–ˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì„œë¹„ìŠ¤ì˜ ê°€ìš©ì„±ê³¼ ì•ˆì •ì„±ì„ ìµœìš°ì„ ìœ¼ë¡œ í•˜ì˜€ìŠµë‹ˆë‹¤.

<br>

### - Why database clustering?

ì‘ë¬¼ ìƒíƒœë‚˜ ì˜¨ë„, ìŠµë„, ì¼ì‚¬ëŸ‰ ë“±ì˜ ì‹¤ì‹œê°„ ê¸°ìƒ ë°ì´í„°ê°€ ëŠê¸°ë©´ ìë™í™” ì‹œìŠ¤í…œì´ ì˜¤ì‘ë™í•  ìˆ˜ ìˆì–´, í´ëŸ¬ìŠ¤í„°(Clustering)ë¡œ ì¥ì•  ëŒ€ë¹„ë¥¼ í–ˆìŠµë‹ˆë‹¤.

<br>

### - Why Calculate database?

ìš´ì˜ DBì— ë¶€í•˜ë¥¼ ì£¼ì§€ ì•Šê³  ë¶„ì„ ì‘ì—…ê³¼ ê³„ì‚° ì‘ì—…ì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ ë³„ë„ì˜ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤. ì‹œê³„ì—´ ë°ì´í„°ë¥¼ ë‹¤ë£¬ë‹¤ëŠ” ì ê³¼ ì§‘ê³„ ì¿¼ë¦¬ë¥¼ ë°˜ë³µ ìˆ˜í–‰í•˜ê¸° ìœ„í•´, ìš´ì˜ ì„œë¹„ìŠ¤ ì„±ëŠ¥ì— ì˜í–¥ì„ ì£¼ì§€ ì•Šë„ë¡ í–ˆìŠµë‹ˆë‹¤.

<br><br>

<h2>ğŸ“Œ Query Sample</h2>

#### - Sample Image

![QuerySample](./images/Sample.png)

```SQL
SELECT cs.farm_id, c.item_name, cs.health_state, cs.growth_size, c.status, c.start_date
FROM crops c
JOIN crops_state cs ON c.id = cs.crops_id
WHERE c.item_name LIKE '%í† ë§ˆí† %'
AND cs.health_state = 'good'
AND c.status = 'growing'
ORDER BY cs.growth_size DESC;
```

<br>

#### - íŠ¹ì • ìœ ì €ì˜ ì£¼ë¬¸ ë‚´ì—­ ì¡°íšŒ

```SQL
--- íŠ¹ì • ìœ ì €ì˜ ì£¼ë¬¸ ë‚´ì—­ ì¡°íšŒ (ì£¼ë¬¸ ìƒíƒœ ë° ì‘ë¬¼ ì •ë³´ í¬í•¨)
SELECT
    o.order_id,
    o.date,
    o.status,
    o.quantity,
    o.price,
    c.item_name,
    c.status AS crop_status
FROM orders o
JOIN crops c ON o.crop_id = c.id
WHERE o.user_id = 3 -- ì¡°íšŒí•  ì‚¬ìš©ì ID
ORDER BY o.date DESC;
```

#### Sample Result

| order_id | date       | status | quantity | price | item_name | crop_status |
| -------- | ---------- | ------ | -------- | ----- | --------- | ----------- |
| 3        | 2025-06-19 | ì·¨ì†Œ   | 2        | 4388  | ë”¸ê¸°      | finished    |

<br><br>

#### - íŠ¹ì • ì§€ì—­ì˜ ìµœì‹  ê¸°ìƒ ì •ë³´ ì¡°íšŒ

```SQL
-- íŠ¹ì • ì§€ì—­ì˜ ìµœì‹  ê¸°ìƒ ì •ë³´ ì¡°íšŒ
SELECT
    w.observation_time,
    w.temp_avg,
    w.humidity,
    w.solar_radiation
FROM weather w
WHERE w.region_id = 'R0056' -- ì§€ì—­ ì½”ë“œ
ORDER BY w.observation_time DESC
LIMIT 1;
```

#### Sample Result

| observation_time    | temp_avg | humidity | solar_radiation |
| ------------------- | -------- | -------- | --------------- |
| 2025-06-19 09:15:42 | 27.7     | 86.7     | 788.9           |

<br><br>

#### - ì£¼ë¬¸ ë° ë°°ì†¡ ìƒíƒœ ì¡°íšŒ

```SQL
-- ì£¼ë¬¸ ë° ë°°ì†¡ ìƒíƒœ ì¡°íšŒ
SELECT
    o.order_id,
    u.name AS customer_name,
    c.item_name AS product_name,
    o.quantity,
    o.price,
    o.status AS order_status,
    d.delivery_status,
    d.courier,
    d.billing_number
FROM
    orders o
JOIN
    users u ON o.user_id = u.id
JOIN
    crops c ON o.crop_id = c.id
LEFT JOIN
    delivery d ON o.order_id = d.delivery_id
WHERE
    o.status NOT IN ('cancelled', 'completed')
ORDER BY
    o.date DESC;
```

#### Sample Result

| order_id | customer_name | product_name | quantity | price | order_status | delivery_status | billing_number |
| -------- | ------------- | ------------ | -------- | ----- | ------------ | --------------- | -------------- | ---------- |
| 46       | í™©í˜œì§„        | í† ë§ˆí†        | 1        | 4209  | ì™„ë£Œ         | delivered       | \*\*íƒë°°       | 4320302486 |

<br><br>

#### + Table Query

 <br>

<details><summary> ğŸ™† ì‚¬ìš©ì í…Œì´ë¸”</summary><div dir="auto">
  <div class="highlight highlight-source-sql notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="CREATE TABLE users (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(10) NOT NULL,
    email VARCHAR(20) NOT NULL UNIQUE,
    birth_date DATETIME NOT NULL, 
    phone_number VARCHAR(13) UNIQUE,
    created_at datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
    home_number VARCHAR(20) UNIQUE,
    address VARCHAR(50) NOT NULL,
    role ENUM('ì¼ë°˜ ì‚¬ìš©ì', 'ìƒì‚°ì') NOT NULL,
    password_hash VARCHAR(100) NOT NULL
);">
<pre><span class="pl-k">CREATE</span> <span class="pl-k">TABLE</span> <span class="pl-en">users</span> (
    id <span class="pl-k">BIGINT</span> <span class="pl-k">AUTO_INCREMENT</span> <span class="pl-k">PRIMARY KEY</span>,
    name <span class="pl-k">VARCHAR</span>(<span class="pl-c1">10</span>) <span class="pl-k">NOT NULL</span>,
    email <span class="pl-k">VARCHAR</span>(<span class="pl-c1">20</span>) <span class="pl-k">NOT NULL</span> <span class="pl-k">UNIQUE</span>,
    birth_date <span class="pl-k">DATETIME</span> <span class="pl-k">NOT NULL</span>, 
    phone_number <span class="pl-k">VARCHAR</span>(<span class="pl-c1">13</span>) <span class="pl-k">UNIQUE</span>,
    created_at <span class="pl-k">DATETIME</span> <span class="pl-k">NOT NULL</span> <span class="pl-k">DEFAULT</span> <span class="pl-c1">CURRENT_TIMESTAMP</span>,
    home_number <span class="pl-k">VARCHAR</span>(<span class="pl-c1">20</span>) <span class="pl-k">UNIQUE</span>,
    address <span class="pl-k">VARCHAR</span>(<span class="pl-c1">50</span>) <span class="pl-k">NOT NULL</span>,
    role <span class="pl-k">ENUM</span>(<span class="pl-s">'ì¼ë°˜ ì‚¬ìš©ì'</span>, <span class="pl-s">'ìƒì‚°ì'</span>) <span class="pl-k">NOT NULL</span>,
    password_hash <span class="pl-k">VARCHAR</span>(<span class="pl-c1">100</span>) <span class="pl-k">NOT NULL</span>
)</pre>
</div>
</details>
<details><summary>ğŸ“’ ê²Œì‹œíŒ í…Œì´ë¸”</summary><div dir="auto">
  <div class="highlight highlight-source-sql notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="CREATE TABLE boards (
    board_id BIGINT AUTO_INCREMENT PRIMARY KEY,
    users_id BIGINT NOT NULL,
    updated_at TIMESTAMP NULL DEFAULT NULL,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    del_yn VARCHAR(1) DEFAULT 'N',
    title VARCHAR(255),
    contents VARCHAR(3000) NOT NULL,
    FOREIGN KEY (users_id) REFERENCES users(id)
);">
<pre><span class="pl-k">CREATE</span> <span class="pl-k">TABLE</span> <span class="pl-en">boards</span> (
    board_id <span class="pl-k">BIGINT</span> <span class="pl-k">AUTO_INCREMENT</span> <span class="pl-k">PRIMARY KEY</span>,
    users_id <span class="pl-k">BIGINT</span> <span class="pl-k">NOT NULL</span>,
    updated_at <span class="pl-k">TIMESTAMP</span> <span class="pl-k">NULL</span> <span class="pl-k">DEFAULT</span> <span class="pl-c1">NULL</span>,
    created_at <span class="pl-k">TIMESTAMP</span> <span class="pl-k">NOT NULL</span> <span class="pl-k">DEFAULT</span> <span class="pl-c1">CURRENT_TIMESTAMP</span>,
    del_yn <span class="pl-k">VARCHAR</span>(<span class="pl-c1">1</span>) <span class="pl-k">DEFAULT</span> <span class="pl-s">'N'</span>,
    title <span class="pl-k">VARCHAR</span>(<span class="pl-c1">255</span>),
    contents <span class="pl-k">VARCHAR</span>(<span class="pl-c1">3000</span>) <span class="pl-k">NOT NULL</span>,
    <span class="pl-k">FOREIGN KEY</span> (users_id) <span class="pl-k">REFERENCES</span> users(id)
)</pre>
</div>
</div>
</details>
<details><summary>âœï¸ ëŒ“ê¸€ í…Œì´ë¸”</summary><div dir="auto">
  <div class="highlight highlight-source-sql notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="CREATE TABLE comments (
    idx BIGINT AUTO_INCREMENT PRIMARY KEY,
    board_id BIGINT NOT NULL,
    comment VARCHAR(1000) NOT NULL,
    comment_date TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    del_yn VARCHAR(1) DEFAULT 'N',
    FOREIGN KEY (board_id) REFERENCES boards(board_id)
);">
<pre><span class="pl-k">CREATE</span> <span class="pl-k">TABLE</span> <span class="pl-en">comments</span> (
    idx <span class="pl-k">BIGINT</span> <span class="pl-k">AUTO_INCREMENT</span> <span class="pl-k">PRIMARY KEY</span>,
    board_id <span class="pl-k">BIGINT</span> <span class="pl-k">NOT NULL</span>,
    comment <span class="pl-k">VARCHAR</span>(<span class="pl-c1">1000</span>) <span class="pl-k">NOT NULL</span>,
    comment_date <span class="pl-k">TIMESTAMP</span> <span class="pl-k">NOT NULL</span> <span class="pl-k">DEFAULT</span> <span class="pl-c1">CURRENT_TIMESTAMP</span>,
    del_yn <span class="pl-k">VARCHAR</span>(<span class="pl-c1">1</span>) <span class="pl-k">DEFAULT</span> <span class="pl-s">'N'</span>,
    <span class="pl-k">FOREIGN KEY</span> (board_id) <span class="pl-k">REFERENCES</span> boards(board_id)
)</pre>
</div>
</div>
</details>
<details><summary>ğŸ”” ì•Œë¦¼ í…Œì´ë¸”</summary><div dir="auto">
  <div class="highlight highlight-source-sql notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="CREATE TABLE notifications (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT NOT NULL,
    status ENUM('sent', 'failed', 'read') NOT NULL,
    title VARCHAR(50),
    content VARCHAR(255),
    created_at DATE,
    FOREIGN KEY (user_id) REFERENCES users(id)
);">
<pre><span class="pl-k">CREATE</span> <span class="pl-k">TABLE</span> <span class="pl-en">notifications</span> (
    id <span class="pl-k">INT</span> <span class="pl-k">AUTO_INCREMENT</span> <span class="pl-k">PRIMARY KEY</span>,
    user_id <span class="pl-k">BIGINT</span> <span class="pl-k">NOT NULL</span>,
    status <span class="pl-k">ENUM</span>(<span class="pl-s">'sent'</span>, <span class="pl-s">'failed'</span>, <span class="pl-s">'read'</span>) <span class="pl-k">NOT NULL</span>,
    title <span class="pl-k">VARCHAR</span>(<span class="pl-c1">50</span>),
    content <span class="pl-k">VARCHAR</span>(<span class="pl-c1">255</span>),
    created_at <span class="pl-k">DATE</span>,
    <span class="pl-k">FOREIGN KEY</span> (user_id) <span class="pl-k">REFERENCES</span> users(id)
)</pre>
</div>
</div>
</details>
<details><summary>ğŸ… ì‘ë¬¼ í…Œì´ë¸”</summary><div dir="auto">
  <div class="highlight highlight-source-sql notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="CREATE TABLE Crops (
    id INT NOT NULL,
    farm_id BIGINT NOT NULL,
    user_id BIGINT NOT NULL,
    item_name VARCHAR(50),
    start_date DATE,
    area DATE,
    status ENUM('growing', 'finished', 'discarded'),
    PRIMARY KEY (id, farm_id),
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (farm_id) REFERENCES Farm(farm_id)
);">
<pre><span class="pl-k">CREATE</span> <span class="pl-k">TABLE</span> <span class="pl-en">Crops</span> (
    id <span class="pl-k">INT</span> <span class="pl-k">NOT NULL</span>,
    farm_id <span class="pl-k">BIGINT</span> <span class="pl-k">NOT NULL</span>,
    user_id <span class="pl-k">BIGINT</span> <span class="pl-k">NOT NULL</span>,
    item_name <span class="pl-k">VARCHAR</span>(<span class="pl-c1">50</span>),
    start_date <span class="pl-k">DATE</span>,
    area <span class="pl-k">DATE</span>,
    status <span class="pl-k">ENUM</span>(<span class="pl-s">'growing'</span>, <span class="pl-s">'finished'</span>, <span class="pl-s">'discarded'</span>),
    <span class="pl-k">PRIMARY KEY</span> (id, farm_id),
    <span class="pl-k">FOREIGN KEY</span> (user_id) <span class="pl-k">REFERENCES</span> users(id),
    <span class="pl-k">FOREIGN KEY</span> (farm_id) <span class="pl-k">REFERENCES</span> Farm(farm_id)
)</pre>
</div>
</details>
<details><summary>ğŸŒ¿ ì‘ë¬¼ ìƒíƒœ í…Œì´ë¸”</summary><div dir="auto">
  <div class="highlight highlight-source-sql notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="CREATE TABLE crops_state (
    id INT AUTO_INCREMENT,
    crops_id INT NOT NULL,
    crops_state ENUM('growing', 'finished', 'discarded'),
    growth_size FLOAT,
    health_state VARCHAR(50),
    sow_start_date DATE,
    price FLOAT,
    PRIMARY KEY (id),
    FOREIGN KEY (crops_id) REFERENCES crops(id)
);">
<pre><span class="pl-k">CREATE</span> <span class="pl-k">TABLE</span> <span class="pl-en">crops_state</span> (
    id <span class="pl-k">INT</span> <span class="pl-k">AUTO_INCREMENT</span>,
    crops_id <span class="pl-k">INT</span> <span class="pl-k">NOT NULL</span>,
    crops_state <span class="pl-k">ENUM</span>(<span class="pl-s">'growing'</span>, <span class="pl-s">'finished'</span>, <span class="pl-s">'discarded'</span>),
    growth_size <span class="pl-k">FLOAT</span>,
    health_state <span class="pl-k">VARCHAR</span>(<span class="pl-c1">50</span>),
    sow_start_date <span class="pl-k">DATE</span>,
    price <span class="pl-k">FLOAT</span>,
    <span class="pl-k">PRIMARY KEY</span> (id),
    <span class="pl-k">FOREIGN KEY</span> (crops_id) <span class="pl-k">REFERENCES</span> crops(id)
)</pre>
</div>
</div>
</details>
<details><summary>ğŸ‘¨â€ğŸŒ¾ ë†ì¥ í…Œì´ë¸”</summary><div dir="auto">
  <div class="highlight highlight-source-sql notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="CREATE TABLE Farm (
    farm_id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT NOT NULL,
    FOREIGN KEY (user_id) REFERENCES users(id)
);">
<pre><span class="pl-k">CREATE</span> <span class="pl-k">TABLE</span> <span class="pl-en">Farm</span> (
    farm_id <span class="pl-k">BIGINT</span> <span class="pl-k">AUTO_INCREMENT</span> <span class="pl-k">PRIMARY KEY</span>,
    user_id <span class="pl-k">BIGINT</span> <span class="pl-k">NOT NULL</span>,
    <span class="pl-k">FOREIGN KEY</span> (user_id) <span class="pl-k">REFERENCES</span> users(id)
)</pre>
</div>
</div>
</details>
<details><summary>ğŸ’¸ ì£¼ë¬¸ í…Œì´ë¸”</summary><div dir="auto">
  <div class="highlight highlight-source-sql notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="CREATE TABLE Orders (
    order_id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT NOT NULL,
    crop_id BIGINT NOT NULL,
    quantity INT NOT NULL,
    price INT NOT NULL,
    status VARCHAR(50),
    request VARCHAR(50),
    date DATE,
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (crop_id) REFERENCES crops(id)
);">
<pre><span class="pl-k">CREATE</span> <span class="pl-k">TABLE</span> <span class="pl-en">Orders</span> (
    order_id <span class="pl-k">BIGINT</span> <span class="pl-k">AUTO_INCREMENT</span> <span class="pl-k">PRIMARY KEY</span>,
    user_id <span class="pl-k">BIGINT</span> <span class="pl-k">NOT NULL</span>,
    crop_id <span class="pl-k">BIGINT</span> <span class="pl-k">NOT NULL</span>,
    quantity <span class="pl-k">INT</span> <span class="pl-k">NOT NULL</span>,
    price <span class="pl-k">INT</span> <span class="pl-k">NOT NULL</span>,
    status <span class="pl-k">VARCHAR</span>(<span class="pl-c1">50</span>),
    request <span class="pl-k">VARCHAR</span>(<span class="pl-c1">50</span>),
    date <span class="pl-k">DATE</span>,
    <span class="pl-k">FOREIGN KEY</span> (user_id) <span class="pl-k">REFERENCES</span> users(id),
    <span class="pl-k">FOREIGN KEY</span> (crop_id) <span class="pl-k">REFERENCES</span> crops(id)
)</pre>
</div>
</div>
</details>
<details><summary>ğŸ­ ì¬ê³  í…Œì´ë¸”</summary><div dir="auto">
  <div class="highlight highlight-source-sql notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="CREATE TABLE Inventory (
    idx INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    crops_id BIGINT NOT NULL,
    farm_id BIGINT NOT NULL,
    expected_harvest_date DATE,
    expected_quantity INT,
    FOREIGN KEY (crops_id) REFERENCES Crops(id),
    FOREIGN KEY (farm_id) REFERENCES Farm(farm_id)
);">
<pre><span class="pl-k">CREATE</span> <span class="pl-k">TABLE</span> <span class="pl-en">Inventory</span> (
    idx <span class="pl-k">INT</span> <span class="pl-k">NOT NULL</span> <span class="pl-k">AUTO_INCREMENT</span> <span class="pl-k">PRIMARY KEY</span>,
    crops_id <span class="pl-k">BIGINT</span> <span class="pl-k">NOT NULL</span>,
    farm_id <span class="pl-k">BIGINT</span> <span class="pl-k">NOT NULL</span>,
    expected_harvest_date <span class="pl-k">DATE</span>,
    expected_quantity <span class="pl-k">INT</span>,
    <span class="pl-k">FOREIGN KEY</span> (crops_id) <span class="pl-k">REFERENCES</span> Crops(id),
    <span class="pl-k">FOREIGN KEY</span> (farm_id) <span class="pl-k">REFERENCES</span> Farm(farm_id)
)</pre>
</div>
</div>
</details>
<details><summary>ğŸ—³ï¸ ë°°ì†¡ í…Œì´ë¸”</summary><div dir="auto">
  <div class="highlight highlight-source-sql notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="CREATE TABLE Delivery (
    id_delivery BIGINT AUTO_INCREMENT PRIMARY KEY,
    delivery_id BIGINT NOT NULL,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,
    de_yn VARCHAR(1) DEFAULT 'N',
    courier VARCHAR(255),
    billing_number VARCHAR(255),
    delivery_at TIMESTAMP,
    delivery_status ENUM('ready', 'shipping', 'delivered', 'cancelled'),
    FOREIGN KEY (delivery_id) REFERENCES Orders(order_id)
);">
<pre><span class="pl-k">CREATE</span> <span class="pl-k">TABLE</span> <span class="pl-en">Delivery</span> (
    id_delivery <span class="pl-k">BIGINT</span> <span class="pl-k">AUTO_INCREMENT</span> <span class="pl-k">PRIMARY KEY</span>,
    delivery_id <span class="pl-k">BIGINT</span> <span class="pl-k">NOT NULL</span>,
    created_at <span class="pl-k">TIMESTAMP</span> <span class="pl-k">NOT NULL</span> <span class="pl-k">DEFAULT</span> <span class="pl-c1">CURRENT_TIMESTAMP</span>,
    updated_at <span class="pl-k">TIMESTAMP</span> <span class="pl-k">NULL</span> <span class="pl-k">DEFAULT</span> <span class="pl-c1">NULL</span> <span class="pl-k">ON UPDATE</span> <span class="pl-c1">CURRENT_TIMESTAMP</span>,
    de_yn <span class="pl-k">VARCHAR</span>(<span class="pl-c1">1</span>) <span class="pl-k">DEFAULT</span> <span class="pl-s">'N'</span>,
    courier <span class="pl-k">VARCHAR</span>(<span class="pl-c1">255</span>),
    billing_number <span class="pl-k">VARCHAR</span>(<span class="pl-c1">255</span>),
    delivery_at <span class="pl-k">TIMESTAMP</span>,
    delivery_status <span class="pl-k">ENUM</span>(<span class="pl-s">'ready'</span>, <span class="pl-s">'shipping'</span>, <span class="pl-s">'delivered'</span>, <span class="pl-s">'cancelled'</span>),
    <span class="pl-k">FOREIGN KEY</span> (delivery_id) <span class="pl-k">REFERENCES</span> Orders(order_id)
)</pre>
</div>
</div>
</details>
<details><summary>ğŸ”ï¸ ì§€ì—­ í…Œì´ë¸”</summary><div dir="auto">
  <div class="highlight highlight-source-sql notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="CREATE TABLE Region (
    region_id VARCHAR(10) PRIMARY KEY,
    farm_id BIGINT NOT NULL,
    latitude DECIMAL(8,6) NOT NULL,
    longitude DECIMAL(9,6) NOT NULL,
    FOREIGN KEY (farm_id) REFERENCES Farm(farm_id)
);">
<pre><span class="pl-k">CREATE</span> <span class="pl-k">TABLE</span> <span class="pl-en">Region</span> (
    region_id <span class="pl-k">VARCHAR</span>(<span class="pl-c1">10</span>) <span class="pl-k">PRIMARY KEY</span>,
    farm_id <span class="pl-k">BIGINT</span> <span class="pl-k">NOT NULL</span>,
    latitude <span class="pl-k">DECIMAL</span>(<span class="pl-c1">8</span>,<span class="pl-c1">6</span>) <span class="pl-k">NOT NULL</span>,
    longitude <span class="pl-k">DECIMAL</span>(<span class="pl-c1">9</span>,<span class="pl-c1">6</span>) <span class="pl-k">NOT NULL</span>,
    <span class="pl-k">FOREIGN KEY</span> (farm_id) <span class="pl-k">REFERENCES</span> Farm(farm_id)
)</pre>
</div>
</div>
</details>
<details><summary>ğŸŒ ë‚ ì”¨ ë°ì´í„° í…Œì´ë¸”</summary><div dir="auto">
  <div class="highlight highlight-source-sql notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="CREATE TABLE Weather (
    observation_time DATETIME NOT NULL,
    region_id VARCHAR(10) NOT NULL,
    temp_avg FLOAT,
    humidity FLOAT,
    solar_radiation FLOAT,
    PRIMARY KEY (observation_time, region_id),
    FOREIGN KEY (region_id) REFERENCES Region(region_id)
);">
<pre><span class="pl-k">CREATE</span> <span class="pl-k">TABLE</span> <span class="pl-en">Weather</span> (
    observation_time <span class="pl-k">DATETIME</span> <span class="pl-k">NOT NULL</span>,
    region_id <span class="pl-k">VARCHAR</span>(<span class="pl-c1">10</span>) <span class="pl-k">NOT NULL</span>,
    temp_avg <span class="pl-k">FLOAT</span>,
    humidity <span class="pl-k">FLOAT</span>,
    solar_radiation <span class="pl-k">FLOAT</span>,
    <span class="pl-k">PRIMARY KEY</span> (observation_time, region_id),
    <span class="pl-k">FOREIGN KEY</span> (region_id) <span class="pl-k">REFERENCES</span> Region(region_id)
)</pre>
</div>
</div>
</details>
<details><summary>ğŸ”­ ì˜ˆì¸¡ í…Œì´ë¸”</summary><div dir="auto">
  <div class="highlight highlight-source-sql notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="CREATE TABLE Predictions (
    idx BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    crops_id BIGINT NOT NULL,
    farm_id BIGINT,
    predicted_harvest_date DATE,
    predicted_quantity INT,
    created_at DATE,
    FOREIGN KEY (crops_id) REFERENCES Crops(id),
    FOREIGN KEY (farm_id) REFERENCES Farm(farm_id)
);">
<pre><span class="pl-k">CREATE</span> <span class="pl-k">TABLE</span> <span class="pl-en">Predictions</span> (
    idx <span class="pl-k">BIGINT</span> <span class="pl-k">NOT NULL</span> <span class="pl-k">AUTO_INCREMENT</span> <span class="pl-k">PRIMARY KEY</span>,
    crops_id <span class="pl-k">BIGINT</span> <span class="pl-k">NOT NULL</span>,
    farm_id <span class="pl-k">BIGINT</span>,
    predicted_harvest_date <span class="pl-k">DATE</span>,
    predicted_quantity <span class="pl-k">INT</span>,
    created_at <span class="pl-k">DATE</span>,
    <span class="pl-k">FOREIGN KEY</span> (crops_id) <span class="pl-k">REFERENCES</span> Crops(id),
    <span class="pl-k">FOREIGN KEY</span> (farm_id) <span class="pl-k">REFERENCES</span> Farm(farm_id)
)</pre>
</div>
</div>
</details>
<br><br>

## ğŸ”§ SQL íŠœë‹

<h3> ì¿¼ë¦¬ êµ¬ì¡° ë³€ê²½ </h3>
<h4> - Joinë¬¸ëŒ€ì‹  Select ë¬¸ì„ ì‚¬ìš©í•˜ì—¬ ì‹œê°„ ë‹¨ì¶• í–¥ìƒ </h4>
  
<br>

![OrderLabs-sql](./images/sql1.png)

![OrderLabs-sql](./images/sql2.png)

<br><br>
users 1000, predictions 100, crops 100, orders 101000ê°œì˜ ë°ì´í„°ë¥¼ Full Scan í–ˆì„ ë–„, ì†ë„ê°€ 0.063ì—ì„œ 0.047ë¡œ ë‹¨ì¶•ë˜ì—ˆë‹¤.

<br><br>

  <h3> Index ì ìš© </h3>

  <h4> - Index ì ìš© ì „ </h4>

![Analyze](./images/Analyze.png)

<br>

```SQL
-> Sort: cs.growth_size DESC  (actual time=2.57..2.57 rows=18 loops=1)
    -> Stream results  (cost=156 rows=72) (actual time=2.23..2.4 rows=18 loops=1)
        -> Nested loop inner join  (cost=156 rows=72) (actual time=2.21..2.38 rows=18 loops=1)
            -> Index lookup on c using idx (status='growing'), with index condition: ((c.`status` = 'growing') and (c.item_name like '%í† ë§ˆí† %'))  (cost=3.8 rows=72) (actual time=0.273..0.277 rows=17 loops=1)
            -> Filter: (cs.health_state = 'good')  (cost=10 rows=1) (actual time=0.104..0.105 rows=1.06 loops=17)
                -> Index lookup on cs using crops_id (crops_id=c.id)  (cost=10 rows=10) (actual time=0.104..0.104 rows=3.41 loops=17)
```

   <br>

  <h4> - Index ìƒì„± í™”ë©´ </h4>

![Index](./images/Index.png)

  <br>

  <h4> - Index ì ìš© í›„ </h4>

![Analyze](./images/AnalyzeIndex.png)

<br>

```SQL
-> Sort: cs.growth_size DESC  (actual time=0.255..0.257 rows=18 loops=1)
    -> Stream results  (cost=93.5 rows=72) (actual time=0.195..0.302 rows=18 loops=1)
        -> Nested loop inner join  (cost=93.5 rows=72) (actual time=0.0874..0.241 rows=18 loops=1)
            -> Index lookup on c using idx (status='growing'), with index condition: ((c.`status` = 'growing') and (c.item_name like '%í† ë§ˆí† %'))  (cost=1.55 rows=72) (actual time=0.0573..0.0609 rows=17 loops=1)
            -> Filter: (cs.health_state = 'good')  (cost=2.51 rows=1) (actual time=0.0898..0.00948 rows=1.06 loops=17)
                -> Index lookup on cs using crops_id (crops_id=c.id)  (cost=2.51 rows=10) (actual time=0.00845..0.00903 rows=3.41 loops=17)
```

<br><br>

<h2>ğŸ“Œ SQL í…ŒìŠ¤íŠ¸</h2>
<div align="center">
  <a href="https://www.notion.so/SQL-21785def4f6d80e2a9e0dc591210f5d7" target="_blank">ğŸ”— SQL í…ŒìŠ¤íŠ¸ ë°”ë¡œê°€ê¸°</a>
</div>
